TCanvas *c1 = 0;
void AdcN() {
  TNtuple *TpcHitNtuple = (TNtuple *) gDirectory->Get("TpcHitNtuple");
  const Int_t N = 101;
  Double_t xbins[N];
  xbins[0]   = 0.05;
  xbins[N-1] = 5000.;
  Double_t dx = TMath::Log(xbins[N-1]/xbins[0])/(N-1);
  for (Int_t i = 1; i < N; i++) xbins[i] = xbins[i-1]*TMath::Exp(dx);
  cout << "bins\t" << xbins[0] << "\t" << xbins[N-1] << endl;
  const Int_t Ny = 101;
  Double_t ybins[Ny];
  ybins[0]   = 0.05;
  ybins[N-1] = 5000.;
  Double_t dy = TMath::Log(ybins[Ny-1]/ybins[0])/(Ny-1);
  for (Int_t i = 1; i < Ny; i++) ybins[i] = ybins[i-1]*TMath::Exp(dy);
  cout << "bins\t" << ybins[0] << "\t" << ybins[Ny-1] << endl;
  TH2D     *Inner2D = new TH2D("Inner2D","Simulated dE (keV) vs Reconstructed dE (keV) inner",N-1,xbins,Ny-1,ybins);
  Inner2D->SetXTitle("Reconstructed dE (keV)                                           ");
  Inner2D->SetYTitle("Simulated dE (keV)");
  Inner2D->SetMarkerColor(4);
  TH2D     *Outer2D = new TH2D("Outer2D","Simulated dE (keV) vs Reconstructed dE (keV) outer",N-1,xbins,Ny-1,ybins);
  Outer2D->SetXTitle("Reconstructed dE (keV)                                           ");
  Outer2D->SetYTitle("Simulated dE (keV)");
  Outer2D->SetMarkerColor(6);
  TProfile *Inner = new TProfile("Inner","Adc/Clustering nonlinearity for Inner sectors",N-1,xbins,"");
  Inner->SetMarkerStyle(20); Inner->SetMarkerColor(2);
  Inner->SetXTitle("Reconstructed dE (keV)                                           ");
  Inner->SetYTitle("Simulated dE (keV)");
  Inner->SetStats(1);
  TProfile *Outer = new TProfile("Outer","Adc/Clustering nonlinearity for Outer sectors",N-1,xbins,"");
  Outer->SetMarkerStyle(20); Outer->SetMarkerColor(3);
  Outer->SetXTitle("Reconstructed dE (keV)                                          ");
  Outer->SetYTitle("Simulated dE (keV)");
  TProfile *innerS = new TProfile("innerS","Adc/Clustering nonlinearity for Inner sectors",N-1,xbins,"");
  innerS->SetMarkerStyle(20); innerS->SetMarkerColor(2);
  innerS->SetYTitle("Reconstructed dE (keV)");
  innerS->SetXTitle("Simulated dE (keV)                       ");
  innerS->SetStats(1);
  TProfile *outerS = new TProfile("outerS","Adc/Clustering nonlinearity for Outer sectors",N-1,xbins,"");
  outerS->SetMarkerStyle(20); outerS->SetMarkerColor(3);
  outerS->SetYTitle("Reconstructed dE (keV)");
  outerS->SetXTitle("Simulated dE (keV)                       ");
  c1 = new TCanvas("IO","Inner/Outer ADC/Clustering nonlinearity");
  c1->SetGrid();
  c1->SetLogx();
  c1->SetLogy();
  TpcHitNtuple->Draw("1e6*dEM:1e6*dER>>Inner2D","row<14&&IdM==IdR&&qR>99&&dEM>0");
  TpcHitNtuple->Draw("1e6*dEM:1e6*dER>>Outer2D","row>=14&&IdM==IdR&&qR>99&&dEM>0");
  TpcHitNtuple->Draw("1e6*dEM:1e6*dER>>Inner","row< 14&&IdM==IdR&&qR>99&&dEM>0&&abs(dER/dEM - 5.71150e-01) < 0.5*0.97","prof");
  TpcHitNtuple->Draw("1e6*dEM:1e6*dER>>Outer","row>=14&&IdM==IdR&&qR>99&&dEM>0&&abs(dER/dEM - 8.38552e-01) < 0.5*1.32","prof");
  TpcHitNtuple->Draw("1e6*dER:1e6*dEM>>innerS","row<14&&IdM==IdR&&qR>99&&dEM>0","prof");
  TpcHitNtuple->Draw("1e6*dER:1e6*dEM>>outerS","row>=14&&IdM==IdR&&qR>99&&dEM>0","prof");
  c1->Clear();
  c1->Divide(1,3);
  c1->cd(1);
  gPad->SetGrid();
  gPad->SetLogx();
  gPad->SetLogy();
  Outer->Draw();
  Inner->Draw();
  Outer->Draw();
  Inner->SetStats(1);
  Inner->Draw("same");
  c1->cd(2);
  gPad->SetGrid();
  gPad->SetLogx();
  gPad->SetLogy();
  Inner2D->Draw();
  Inner->Draw("same");
  c1->cd(3);
  gPad->SetGrid();
  gPad->SetLogx();
  gPad->SetLogy();
  Outer2D->Draw();
  Outer->Draw("same");
}
