#if !defined(__CINT__)
// code that should be seen ONLY by the compiler
#else
#if !defined(__CINT__) || defined(__MAKECINT__)
// code that should be seen by the compiler AND rootcint
#else
// code that should always be seen
#endif
#endif
//________________________________________________________________________________
#if !defined(__CINT__) || defined(__MAKECINT__)
#include "Riostream.h"
//#include <ofstream>
#include <stdio.h>
#include <string.h>
#include "TROOT.h"
#include "TSystem.h"
#include "TMath.h"
#include "TNtuple.h"
#include "TString.h"
#include "TFile.h"
#include "TDatime.h"
#include "TUnixTime.h"
#include "TMath.h"
#endif
struct BPoint_t {
  Float_t day, date, time, currI, currO, dday, dcurrI, dcurrO, sumI, sumO; //
  Float_t dcurrI5, dcurrO5, dcurrI10, dcurrO10, dcurrI20, dcurrO20;
  Float_t dcurrRMSI5, dcurrRMSO5, dcurrRMSI10, dcurrRMSO10, dcurrRMSI20, dcurrRMSO20;
  Float_t I5, I10, I20;
  Float_t repeat;
};
BPoint_t BPoint, BPointO, BPoints[20];
TFile *f = 0;
//________________________________________________________________________________
void CreatetpcAcCharge(Float_t qI, Float_t qO, Int_t date, Int_t time) {
  TString fOut =  Form("tpcAcCharge.%8i.%06i.C", date, time);
  ofstream out;
  cout << "Create " << fOut << endl;
  out.open(fOut.Data());
  out << "TDataSet *CreateTable() {" << endl;
  out << "  if (!gROOT->GetClass(\"St_tpcAcCharge\")) return 0;" << endl;
  out << "  tpcAcCharge_st row = ";
  out << " {" << qI << "," << qO << "};" << endl;
  out << "  St_tpcAcCharge *tableSet = new St_tpcAcCharge(\"tpcAcCharge\",1);" << endl; 
  out << "  tableSet->AddAt(&row.chargeI, 0);" << endl;
  out << "  return (TDataSet *)tableSet;" << endl;
  out << "}" << endl;
  out.close(); 
}
//________________________________________________________________________________
void MakeNTuple4Current() {//const Char_t *DirName=".") {
  f = new TFile("Current14.root","RECREATE");
  TNtuple *FitP = new TNtuple("FitP","Anode Current",
			      "day:date:time:currI:currO:dday:dcurrI:dcurrO:sumI:sumO"
			      ":dcurrI5:dcurrO5:dcurrI10:dcurrO10:dcurrI20:dcurrO20"
			      ":dcurrRMSI5:dcurrRMSO5:dcurrRMSI10:dcurrRMSO10:dcurrRMSI20:dcurrRMSO20"
			      ":I5:I10:I20"
			      ":repeat");
  memset (&BPoint.day, 0, sizeof(BPoint_t));
  memset (&BPointO.day, 0, sizeof(BPoint_t));
  memset (&BPoints[0].day, 0, 20*sizeof(BPoint_t));
  const Char_t *FileList[] = {
    "2006-01-03_2006-01-23","2006-01-23_2006-01-26","2006-01-27_2006-01-31","2006-01-30_2006-01-31","2006-01-31_2006-02-01",
    "2006-02-01_2006-02-08","2006-02-08_2006-02-14","2006-02-14_2006-02-21","2006-02-21_2006-02-28","2006-02-28_2006-03-03",
    "2006-03-03_2006-03-05","2006-03-05_2006-03-08","2006-03-08_2006-03-11","2006-03-11_2006-03-14","2006-03-14_2006-03-16",
    "2006-03-16_2006-03-18","2006-03-18_2006-03-20","2006-03-20_2006-03-22","2006-03-22_2006-03-24","2006-03-24_2006-03-26",
    "2006-03-26_2006-03-28","2006-03-28_2006-03-30",
    "2006-03-30_2006-04-01","2006-03-31_2006-04-02","2006-04-02_2006-04-04","2006-04-04_2006-04-06","2006-04-06_2006-04-08",
    "2006-04-08_2006-04-09","2006-04-09_2006-04-11","2006-04-11_2006-04-13","2006-04-13_2006-04-15","2006-04-15_2006-04-17",
    "2006-04-17_2006-04-18","2006-04-18_2006-04-19","2006-04-23_2006-04-27","2006-04-27_2006-04-28","2006-04-28_2006-04-29",
    "2006-04-29_2006-04-30","2006-04-30_2006-05-01",
    "2006-05-01_2006-05-02","2006-05-02_2006-05-03","2006-05-03_2006-05-04","2006-05-04_2006-05-05","2006-05-05_2006-05-06",
    "2006-05-06_2006-05-07","2006-05-07_2006-05-08","2006-05-08_2006-05-09","2006-05-09_2006-05-10","2006-05-10_2006-05-11",
    "2006-05-11_2006-05-12","2006-05-12_2006-05-13","2006-05-13_2006-05-14","2006-05-14_2006-05-15","2006-05-15_2006-05-16",
    "2006-05-16_2006-05-17","2006-05-17_2006-05-18","2006-05-18_2006-05-19","2006-05-19_2006-05-20","2006-05-20_2006-05-21",
    "2006-05-21_2006-05-22","2006-05-22_2006-05-23","2006-05-23_2006-05-24","2006-05-24_2006-05-25","2006-05-25_2006-05-26",
    "2006-05-26_2006-05-27","2006-05-27_2006-05-28","2006-05-28_2006-05-29","2006-05-29_2006-05-30","2006-05-30_2006-05-31",
    "2006-05-31_2006-06-01",
    "2006-06-01_2006-06-02","2006-06-02_2006-06-03","2006-06-03_2006-06-04","2006-06-04_2006-06-05","2006-06-05_2006-06-06",
    "2006-06-06_2006-06-07","2006-06-07_2006-06-08","2006-06-08_2006-06-09","2006-06-09_2006-06-10","2006-06-10_2006-06-11",
    "2006-06-11_2006-06-12","2006-06-12_2006-06-13","2006-06-13_2006-06-14","2006-06-14_2006-06-15","2006-06-15_2006-06-16",
    "2006-06-16_2006-06-17","2006-06-17_2006-06-18","2006-06-18_2006-06-19","2006-06-19_2006-06-20","2006-06-20_2006-06-21",
    "2006-06-21_2006-06-22","2006-06-22_2006-06-23","2006-06-23_2006-06-24","2006-06-24_2006-06-25","2006-06-25_2006-06-26",
    
    "2007-02-07_2007-02-08","2007-02-08_2007-02-09","2007-02-09_2007-02-10","2007-02-10_2007-02-11","2007-02-11_2007-02-12",
    "2007-02-12_2007-02-13","2007-02-13_2007-02-14","2007-02-14_2007-02-15","2007-02-15_2007-02-16","2007-02-16_2007-02-17",
    "2007-02-17_2007-02-18","2007-02-18_2007-02-19","2007-02-19_2007-02-20","2007-02-20_2007-02-21","2007-02-21_2007-02-22",
    "2007-02-22_2007-02-23","2007-02-23_2007-02-24","2007-02-24_2007-02-25","2007-02-25_2007-02-26","2007-02-26_2007-02-27",
    "2007-02-27_2007-02-28","2007-02-28_2007-03-01",
    "2007-03-01_2007-03-02","2007-03-02_2007-03-03","2007-03-03_2007-03-04","2007-03-04_2007-03-05","2007-03-05_2007-03-06",
    "2007-03-06_2007-03-07","2007-03-07_2007-03-08","2007-03-08_2007-03-09","2007-03-09_2007-03-10","2007-03-10_2007-03-11",
    "2007-03-11_2007-03-12","2007-03-12_2007-03-13","2007-03-13_2007-03-14","2007-03-14_2007-03-15","2007-03-15_2007-03-16",
    "2007-03-16_2007-03-17","2007-03-17_2007-03-18","2007-03-18_2007-03-19","2007-03-19_2007-03-20","2007-03-20_2007-03-21",
    "2007-03-21_2007-03-22","2007-03-22_2007-03-23","2007-03-23_2007-03-24","2007-03-24_2007-03-25","2007-03-25_2007-03-26",
    "2007-03-26_2007-03-27","2007-03-27_2007-03-28","2007-03-28_2007-03-29","2007-03-29_2007-03-30","2007-03-30_2007-03-31",
    "2007-03-31_2007-04-01","2007-04-01_2007-04-02","2007-04-02_2007-04-03","2007-04-03_2007-04-04","2007-04-04_2007-04-05",
    "2007-04-05_2007-04-06","2007-04-06_2007-04-07","2007-04-07_2007-04-08","2007-04-08_2007-04-09","2007-04-09_2007-04-10",
    "2007-04-10_2007-04-11","2007-04-11_2007-04-12","2007-04-12_2007-04-13","2007-04-13_2007-04-14","2007-04-14_2007-04-15",
    "2007-04-15_2007-04-16","2007-04-16_2007-04-17","2007-04-17_2007-04-18","2007-04-18_2007-04-19","2007-04-19_2007-04-20",
    "2007-04-20_2007-04-21","2007-04-21_2007-04-22","2007-04-22_2007-04-23","2007-04-23_2007-04-24","2007-04-24_2007-04-25",
    "2007-04-25_2007-04-26","2007-04-26_2007-04-27","2007-04-27_2007-04-28","2007-04-28_2007-04-29","2007-04-29_2007-04-30",
    "2007-04-30_2007-05-01","2007-05-01_2007-05-02","2007-05-02_2007-05-03","2007-05-03_2007-05-04","2007-05-04_2007-05-05",
    "2007-05-05_2007-05-06","2007-05-06_2007-05-07","2007-05-07_2007-05-08","2007-05-08_2007-05-09","2007-05-09_2007-05-10",
    "2007-05-10_2007-05-11","2007-05-11_2007-05-12","2007-05-12_2007-05-13","2007-05-13_2007-05-14","2007-05-14_2007-05-15",
    "2007-05-15_2007-05-16","2007-05-16_2007-05-17","2007-05-17_2007-05-18","2007-05-18_2007-05-19","2007-05-19_2007-05-20",
    "2007-05-20_2007-05-21","2007-05-21_2007-05-22","2007-05-22_2007-05-23","2007-05-23_2007-05-24","2007-05-24_2007-05-25",
    "2007-05-25_2007-05-26","2007-05-26_2007-05-27","2007-05-27_2007-05-28","2007-05-28_2007-05-29","2007-05-29_2007-05-30",
    "2007-05-30_2007-05-31","2007-05-31_2007-06-01",
    "2007-06-01_2007-06-02","2007-06-02_2007-06-03","2007-06-03_2007-06-04","2007-06-04_2007-06-05","2007-06-05_2007-06-06",
    "2007-06-06_2007-06-07","2007-06-07_2007-06-08","2007-06-08_2007-06-09","2007-06-09_2007-06-10","2007-06-10_2007-06-11",
    "2007-06-11_2007-06-12","2007-06-12_2007-06-13","2007-06-13_2007-06-14","2007-06-14_2007-06-15","2007-06-15_2007-06-16",
    "2007-06-16_2007-06-17","2007-06-17_2007-06-18","2007-06-18_2007-06-19","2007-06-19_2007-06-20","2007-06-20_2007-06-21",
    "2007-06-21_2007-06-22","2007-06-22_2007-06-23","2007-06-23_2007-06-24","2007-06-24_2007-06-25","2007-06-25_2007-06-26",
    "2007-06-26_2007-06-27","2007-06-27_2007-06-28","2007-06-28_2007-06-29","2007-06-29_2007-06-20","2007-06-30_2007-06-31",
    
    "2007-11-01_2007-11-02","2007-11-02_2007-11-03","2007-11-03_2007-11-04","2007-11-04_2007-11-05","2007-11-05_2007-11-06",
    "2007-11-06_2007-11-07","2007-11-07_2007-11-08","2007-11-08_2007-11-09","2007-11-09_2007-11-10","2007-11-10_2007-11-11",
    "2007-11-11_2007-11-12","2007-11-12_2007-11-13","2007-11-13_2007-11-14","2007-11-14_2007-11-15","2007-11-15_2007-11-16",
    "2007-11-16_2007-11-17","2007-11-17_2007-11-18","2007-11-18_2007-11-19","2007-11-19_2007-11-20","2007-11-20_2007-11-21",
    "2007-11-21_2007-11-22","2007-11-22_2007-11-23","2007-11-23_2007-11-24","2007-11-24_2007-11-25","2007-11-25_2007-11-26",
    "2007-11-26_2007-11-27","2007-11-27_2007-11-28","2007-11-28_2007-11-29","2007-11-29_2007-11-30","2007-11-30_2007-11-31",
    "2007-11-31_2007-12-01",
    "2007-12-01_2007-12-02","2007-12-02_2007-12-03","2007-12-03_2007-12-04","2007-12-04_2007-12-05","2007-12-05_2007-12-06",
    "2007-12-06_2007-12-07","2007-12-07_2007-12-08","2007-12-08_2007-12-09","2007-12-09_2007-12-10","2007-12-10_2007-12-11",
    "2007-12-11_2007-12-12","2007-12-12_2007-12-13","2007-12-13_2007-12-14","2007-12-14_2007-12-15","2007-12-15_2007-12-16",
    "2007-12-16_2007-12-17","2007-12-17_2007-12-18","2007-12-18_2007-12-19","2007-12-19_2007-12-20","2007-12-20_2007-12-21",
    "2007-12-21_2007-12-22","2007-12-22_2007-12-23","2007-12-23_2007-12-24","2007-12-24_2007-12-25","2007-12-25_2007-12-26",
    "2007-12-26_2007-12-27","2007-12-27_2007-12-28","2007-12-28_2007-12-29","2007-12-29_2007-12-30","2007-12-30_2007-12-31",
    "2007-12-31_2007-12-01",
    "2008-01-01_2008-01-02","2008-01-02_2008-01-03","2008-01-03_2008-01-04","2008-01-04_2008-01-05","2008-01-05_2008-01-06",
    "2008-01-06_2008-01-07","2008-01-07_2008-01-08","2008-01-08_2008-01-09","2008-01-09_2008-01-10","2008-01-10_2008-01-11",
    "2008-01-11_2008-01-12","2008-01-12_2008-01-13","2008-01-13_2008-01-14","2008-01-14_2008-01-15","2008-01-15_2008-01-16",
    "2008-01-16_2008-01-17","2008-01-17_2008-01-18","2008-01-18_2008-01-19","2008-01-19_2008-01-20","2008-01-20_2008-01-21",
    "2008-01-21_2008-01-22","2008-01-22_2008-01-23","2008-01-23_2008-01-24","2008-01-24_2008-01-25","2008-01-25_2008-01-26",
    "2008-01-26_2008-01-27","2008-01-27_2008-01-28","2008-01-28_2008-01-29","2008-01-29_2008-01-30","2008-01-30_2008-01-31",
    "2008-01-31_2008-02-01",
    "2008-02-01_2008-02-02","2008-02-02_2008-02-03","2008-02-03_2008-02-04","2008-02-04_2008-02-05","2008-02-05_2008-02-06",
    "2008-02-06_2008-02-07","2008-02-07_2008-02-08","2008-02-08_2008-02-09","2008-02-09_2008-02-10","2008-02-10_2008-02-11",
    "2008-02-11_2008-02-12","2008-02-12_2008-02-13","2008-02-13_2008-02-14","2008-02-14_2008-02-15","2008-02-15_2008-02-16",
    "2008-02-16_2008-02-17","2008-02-17_2008-02-18","2008-02-18_2008-02-19","2008-02-19_2008-02-20","2008-02-20_2008-02-21",
    "2008-02-21_2008-02-22","2008-02-22_2008-02-23","2008-02-23_2008-02-24","2008-02-24_2008-02-25","2008-02-25_2008-02-26",
    "2008-02-26_2008-02-27","2008-02-27_2008-02-28","2008-02-28_2008-03-01",
    "2008-03-01_2008-03-02","2008-03-02_2008-03-03","2008-03-03_2008-03-04","2008-03-04_2008-03-05","2008-03-05_2008-03-06",
    "2008-03-06_2008-03-07","2008-03-07_2008-03-08","2008-03-08_2008-03-09","2008-03-09_2008-03-10","2008-03-10_2008-03-11",
    "2008-03-11_2008-03-12","2008-03-12_2008-03-13","2008-03-13_2008-03-14","2008-03-14_2008-03-15","2008-03-15_2008-03-16",
    "2008-03-16_2008-03-17","2008-03-17_2008-03-18","2008-03-18_2008-03-19","2008-03-19_2008-03-20","2008-03-20_2008-03-21",
    "2008-03-21_2008-03-22","2008-03-22_2008-03-23","2008-03-23_2008-03-24","2008-03-24_2008-03-25","2008-03-25_2008-03-26",
    "2008-03-26_2008-03-27","2008-03-27_2008-03-28","2008-03-28_2008-03-29","2008-03-29_2008-03-30","2008-03-30_2008-03-31",
    
    "2009-01-01_2009-01-02","2009-01-02_2009-01-03","2009-01-03_2009-01-04","2009-01-04_2009-01-05","2009-01-05_2009-01-06",
    "2009-01-06_2009-01-07","2009-01-07_2009-01-08","2009-01-08_2009-01-09","2009-01-09_2009-01-10","2009-01-10_2009-01-11",
    "2009-01-11_2009-01-12","2009-01-12_2009-01-13","2009-01-13_2009-01-14","2009-01-14_2009-01-15","2009-01-15_2009-01-16",
    "2009-01-16_2009-01-17","2009-01-17_2009-01-18","2009-01-18_2009-01-19","2009-01-19_2009-01-20","2009-01-20_2009-01-21",
    "2009-01-21_2009-01-22","2009-01-22_2009-01-23","2009-01-23_2009-01-24","2009-01-24_2009-01-25","2009-01-25_2009-01-26",
    "2009-01-26_2009-01-27","2009-01-27_2009-01-28","2009-01-28_2009-01-29","2009-01-29_2009-01-30","2009-01-30_2009-01-31",
    "2009-01-31_2009-02-01",
    "2009-02-02_2009-02-03","2009-02-03_2009-02-04","2009-02-04_2009-02-05","2009-02-05_2009-02-06","2009-02-06_2009-02-07",
    "2009-02-07_2009-02-08","2009-02-08_2009-02-09","2009-02-09_2009-02-10","2009-02-10_2009-02-11","2009-02-11_2009-02-12",
    "2009-02-12_2009-02-13","2009-02-13_2009-02-14","2009-02-14_2009-02-15","2009-02-15_2009-02-16","2009-02-16_2009-02-17",
    "2009-02-17_2009-02-18","2009-02-18_2009-02-19","2009-02-19_2009-02-20","2009-02-20_2009-02-21","2009-02-21_2009-02-22",
    "2009-02-22_2009-02-23","2009-02-23_2009-02-24","2009-02-24_2009-02-25","2009-02-25_2009-02-26","2009-02-26_2009-02-27",
    "2009-02-27_2009-02-28","2009-02-28_2009-03-01",
    "2009-03-01_2009-03-02","2009-03-02_2009-03-03","2009-03-03_2009-03-04","2009-03-04_2009-03-05","2009-03-05_2009-03-06",
    "2009-03-06_2009-03-07","2009-03-07_2009-03-08","2009-03-08_2009-03-09","2009-03-09_2009-03-10","2009-03-10_2009-03-11",
    "2009-03-11_2009-03-12","2009-03-12_2009-03-13","2009-03-13_2009-03-14","2009-03-14_2009-03-15","2009-03-15_2009-03-16",
    "2009-03-16_2009-03-17","2009-03-17_2009-03-18","2009-03-18_2009-03-19","2009-03-19_2009-03-20","2009-03-20_2009-03-21",
    "2009-03-21_2009-03-22","2009-03-22_2009-03-23","2009-03-23_2009-03-24","2009-03-24_2009-03-25","2009-03-25_2009-03-26",
    "2009-03-26_2009-03-27","2009-03-27_2009-03-28","2009-03-28_2009-03-29","2009-03-29_2009-03-30","2009-03-30_2009-03-31",
    "2009-03-31_2009-04-01",
    "2009-04-01_2009-04-02","2009-04-02_2009-04-03","2009-04-03_2009-04-04","2009-04-04_2009-04-05","2009-04-05_2009-04-06",
    "2009-04-06_2009-04-07","2009-04-07_2009-04-08","2009-04-08_2009-04-09","2009-04-09_2009-04-10","2009-04-10_2009-04-11",
    "2009-04-11_2009-04-12","2009-04-12_2009-04-13","2009-04-13_2009-04-14","2009-04-14_2009-04-15","2009-04-15_2009-04-16",
    "2009-04-16_2009-04-17","2009-04-17_2009-04-18","2009-04-18_2009-04-19","2009-04-19_2009-04-20","2009-04-20_2009-04-21",
    "2009-04-21_2009-04-22","2009-04-22_2009-04-23","2009-04-23_2009-04-24","2009-04-24_2009-04-25","2009-04-25_2009-04-26",
    "2009-04-26_2009-04-27","2009-04-27_2009-04-28","2009-04-28_2009-04-29","2009-04-29_2009-04-30","2009-04-30_2009-05-01",
    "2009-05-01_2009-05-02","2009-05-02_2009-05-03","2009-05-03_2009-05-04","2009-05-04_2009-05-05","2009-05-05_2009-05-06",
    "2009-05-06_2009-05-07","2009-05-07_2009-05-08","2009-05-08_2009-05-09","2009-05-09_2009-05-10","2009-05-10_2009-05-11",
    "2009-05-11_2009-05-12","2009-05-12_2009-05-13","2009-05-13_2009-05-14","2009-05-14_2009-05-15","2009-05-15_2009-05-16",
    "2009-05-16_2009-05-17","2009-05-17_2009-05-18","2009-05-18_2009-05-19","2009-05-19_2009-05-20","2009-05-20_2009-05-21",
    "2009-05-21_2009-05-22","2009-05-22_2009-05-23","2009-05-23_2009-05-24","2009-05-24_2009-05-25","2009-05-25_2009-05-26",
    "2009-05-26_2009-05-27","2009-05-27_2009-05-28","2009-05-28_2009-05-29","2009-05-29_2009-05-30","2009-05-30_2009-05-31",
    "2009-05-31_2009-06-01",
    "2009-06-01_2009-06-02","2009-06-02_2009-06-03","2009-06-03_2009-06-04","2009-06-04_2009-06-05","2009-06-05_2009-06-06",
    "2009-06-06_2009-06-07","2009-06-07_2009-06-08","2009-06-08_2009-06-09","2009-06-09_2009-06-10","2009-06-10_2009-06-11",
    "2009-06-11_2009-06-12","2009-06-12_2009-06-13","2009-06-13_2009-06-14","2009-06-14_2009-06-15","2009-06-15_2009-06-16",
    "2009-06-16_2009-06-17","2009-06-17_2009-06-18","2009-06-18_2009-06-19","2009-06-19_2009-06-20","2009-06-20_2009-06-21",
    "2009-06-21_2009-06-22","2009-06-22_2009-06-23","2009-06-23_2009-06-24","2009-06-24_2009-06-25","2009-06-25_2009-06-26",
    "2009-06-26_2009-06-27","2009-06-27_2009-06-28","2009-06-28_2009-06-29","2009-06-29_2009-06-30","2009-06-30_2009-07-01",
    "2009-07-01_2009-07-02","2009-07-02_2009-07-03","2009-07-03_2009-07-04","2009-07-04_2009-07-05","2009-07-05_2009-07-06"};
  Int_t N = sizeof(FileList)/sizeof(Char_t*);
  char line[121];
  Int_t mon, day, year, hour, min;
  Float_t sec, currI=0, currO=0;
  TDatime dtime(20010101,0);
  UInt_t u0 = dtime.Convert();
  TUnixTime tut;
  Int_t k = 0;
  Double_t baseI = 0;
  Double_t baseO = 0;
  Int_t BaseCount = 0;
  Double_t QI = -0.1;
  Int_t idate, itime;
  for (Int_t i = 0; i < N; i++) {
    TString File(FileList[i]);
    FILE *fp = fopen(File.Data(),"r");
    if (! fp) {
      cout << "Can't open" << File.Data() << endl;
      return;
    } 
    cout << "Opened " <<  File.Data() << endl;
    while ( memset(line,0,121), fgets(&line[0],120,fp)) {
      TString Line(line);
      //      printf("%s",line);
      Int_t repeatI = 0, repeatO = 0;
      if (line[0] == '#') continue;
      if (Line.BeginsWith("time start")) continue;
      if (Line.Contains("INVALID")) continue;
      if (Line.Contains("ARCH_DISCONNECT")) continue;
      if (Line.Contains("ARCH_STOPPED")) continue;
      if (Line.Contains("MAJOR")) continue;
      if (Line.Contains("MINOR")) continue;
      if (Line.Contains("nan",TString::kIgnoreCase)) continue;
      if (Line.Contains("ARCH_REPEAT")) {
	Int_t n = sscanf(Line.Data(),"%2d/%2d/%4d%2d:%2d:%f %f %f ARCH_REPEAT %i",&mon,&day,&year,&hour,&min,&sec,&currO,&currI,&repeatO); 
	if (n != 9) {
	  n = sscanf(Line.Data(),"%2d/%2d/%4d%2d:%2d:%f %f ARCH_REPEAT %i %f ARCH_REPEAT %i",
		     &mon,&day,&year,&hour,&min,&sec,&currO,&repeatI,&currI,&repeatO);
	  assert(n == 9 || n == 10);
	  if (n == 9) repeatO = 0;
	}
      } else {
	sscanf(Line.Data(),"%2d/%2d/%4d%2d:%2d:%f %f %f",&mon,&day,&year,&hour,&min,&sec,&currO,&currI); 
      }
      //    printf("%i %s",n,line);
      if (TMath::IsNaN(currI) || TMath::IsNaN(currO)) {
	printf("Read NaN in %s",line);
	printf("%2d/%2d/%4d %2d:%2d:%f %f %f\n",mon,day,year,hour,min,sec,currO,currI);
	continue;
      }
      //      if (currI == BPointO.currI && currO == BPointO.currO) continue;
      Int_t repeate = 0;
      if (repeatI && repeatO) repeate = TMath::Min(repeatI, repeatO);
      else {
	if (repeatI) repeate = repeatI;
	if (repeatO) repeate = repeatO;
      }
      if (repeate == 1) continue;
      if (currO < -10 || currO > 6 || currI < -10 || currI > 20) continue;
      //      if (day > 31) assert(0);
      dtime.Set(year,mon,day,hour,min,(Int_t)sec);
      UInt_t u1 = dtime.Convert(kTRUE);
      if (k%1000 == 0) {
	printf("%s",Line.Data());
	printf("%2d/%2d/%4d %2d:%2d:%f %f %f %i %i\n",mon,day,year,hour,min,sec,currO,currI,u1,repeate);
      }
      TDatime dt;
      UInt_t u = (UInt_t) (24*3600*BPointO.day) + 30;
      if (u < u1 - 30*repeate) u = u1 - 30*repeate;
      Double_t daysec = 24*3600;
      for (; (!repeate && u <= u1) || (repeate && u < u1); u+= 30) {
	dt.Set(u);
	idate = dt.GetDate();
	itime = dt.GetTime();
	Float_t td = (u - u0)/daysec;
	BPoint.dday = td - BPointO.day;
	if (BPoint.dday <= 0) continue;
	BPoint.day = td;
	BPoint.date = idate;
	BPoint.time = itime;
	BPoint.dcurrI = (currI - BPointO.currI)/BPoint.dday;
	if (BPoint.dcurrI > 2e4) continue;
	BPoint.dcurrO = (currO - BPointO.currO)/BPoint.dday;
	if (BPoint.dcurrO > 1e4) continue;
	BPoint.currI = currI;
	BPoint.currO = currO;
	BPoint.repeat = repeate;
	Float_t dcurrI5  = BPoint.dcurrI;
	Float_t dcurrO5  = BPoint.dcurrO;
	Float_t dcurrI10 = BPoint.dcurrI;
	Float_t dcurrO10 = BPoint.dcurrO;
	Float_t dcurrI20 = BPoint.dcurrI;
	Float_t dcurrO20 = BPoint.dcurrO;
	Float_t dcurrSqI5  = BPoint.dcurrI*BPoint.dcurrI;
	Float_t dcurrSqO5  = BPoint.dcurrO*BPoint.dcurrO;
	Float_t dcurrSqI10 = BPoint.dcurrI*BPoint.dcurrI;
	Float_t dcurrSqO10 = BPoint.dcurrO*BPoint.dcurrO;
	Float_t dcurrSqI20 = BPoint.dcurrI*BPoint.dcurrI;
	Float_t dcurrSqO20 = BPoint.dcurrO*BPoint.dcurrO;
	Int_t I5  = 1;
	Int_t I10 = 1;
	Int_t I20 = 1;
	Int_t ientry = k%20;
	BPoints[ientry] = BPoint;
	Int_t jentry = k - 20;
	if (jentry < 0) jentry = 0;
	for (; jentry < k; jentry++) {
	  Int_t ii = jentry%20;
	  if (k - jentry <  5) { 
	    I5++; 
	    dcurrI5  += BPoints[ii].dcurrI; 
	    dcurrO5  += BPoints[ii].dcurrO;
	    dcurrSqI5  += BPoints[ii].dcurrI*BPoints[ii].dcurrI; 
	    dcurrSqO5  += BPoints[ii].dcurrO*BPoints[ii].dcurrO;
	  }
	  if (k - jentry <  10) { 
	    I10++; 
	    dcurrI10  += BPoints[ii].dcurrI; 
	    dcurrO10  += BPoints[ii].dcurrO;
	    dcurrSqI10  += BPoints[ii].dcurrI*BPoints[ii].dcurrI; 
	    dcurrSqO10  += BPoints[ii].dcurrO*BPoints[ii].dcurrO;
	  }
	  if (k - jentry <  20) { 
	    I20++; 
	    dcurrI20  += BPoints[ii].dcurrI; 
	    dcurrO20  += BPoints[ii].dcurrO;
	    dcurrSqI20  += BPoints[ii].dcurrI*BPoints[ii].dcurrI; 
	    dcurrSqO20  += BPoints[ii].dcurrO*BPoints[ii].dcurrO;
	  }
	}
	BPoint.I5 = I5;
	BPoint.dcurrI5  = dcurrI5 /I5; BPoint.dcurrRMSI5  = TMath::Sqrt(dcurrSqI5/I5 - BPoint.dcurrI5*BPoint.dcurrI5);
	BPoint.dcurrO5  = dcurrO5 /I5; BPoint.dcurrRMSO5  = TMath::Sqrt(dcurrSqO5/I5 - BPoint.dcurrO5*BPoint.dcurrO5);
	BPoint.I10 = I10;
	BPoint.dcurrI10  = dcurrI10 /I10; BPoint.dcurrRMSI10  = TMath::Sqrt(dcurrSqI10/I10 - BPoint.dcurrI10*BPoint.dcurrI10);
	BPoint.dcurrO10  = dcurrO10 /I10; BPoint.dcurrRMSO10  = TMath::Sqrt(dcurrSqO10/I10 - BPoint.dcurrO10*BPoint.dcurrO10);
	BPoint.I20 = I20;
	BPoint.dcurrI20  = dcurrI20 /I20; BPoint.dcurrRMSI20  = TMath::Sqrt(dcurrSqI20/I20 - BPoint.dcurrI20*BPoint.dcurrI20);
	BPoint.dcurrO20  = dcurrO20 /I20; BPoint.dcurrRMSO20  = TMath::Sqrt(dcurrSqO20/I20 - BPoint.dcurrO20*BPoint.dcurrO20);
	if (BPoint.dcurrRMSI10 < 20 && BPoint.dcurrRMSO10 < 20) {
	  BaseCount++;
	  if (BaseCount > 0) {
	    baseI = BPoint.currI;
	    baseO = BPoint.currO;
	  }
	} else BaseCount = 0;
	if (BPoint.currI < baseI) BPoint.currI = baseI;
	if (BPoint.currO < baseO) BPoint.currO = baseO;
	BPoint.sumI  = BPointO.sumI + (BPointO.currI-baseI)*BPoint.dday*daysec*1e-6;
	BPoint.sumO  = BPointO.sumO + (BPointO.currO-baseO)*BPoint.dday*daysec*1e-6;
	FitP->Fill(&BPoint.day);
	BPointO = BPoint;
	if (BPoint.sumI - QI > 0.1) {
	  CreatetpcAcCharge(BPoint.sumI,BPoint.sumO,idate,itime);
	  QI = BPoint.sumI;
	}
      }
      k++;
      //    if (i > 10) break;
      //    if (i%10 == 1) cout << "i:" << i << "\t" << line;
    }
    fclose(fp);
  }
  f->Write();
}
