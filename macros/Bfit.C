//
//   Example of a program to fit non-equidistant data points
//   =======================================================
//
//   The fitting function fcn is a simple chisquare function
//   The data consists of 5 data points (arrays x,y,z) + the errors in errorsz
//   More details on the various functions or parameters for these functions
//   can be obtained in an interactive ROOT session with:
//    Root > TMinuit *minuit = new TMinuit(10);
//    Root > minuit->mnhelp("*")  to see the list of possible keywords
//    Root > minuit->mnhelp("SET") explains most parameters
//

#include "TMinuit.h"
struct Point_t {
  Int_t    bin;
  Int_t    NPoint;
  Double_t x;
  Double_t p;
  Double_t z; // correction wrt Manuel
  Double_t y;
  Double_t dy;
};
//bin, Point, x, p, Delta_I, I, Sigma_I, chisq, NoPoints,ndf, prob
Point_t dEdxZ[]  = {
//bin, Point, x, p, Delta_I, I, Sigma_I, chisq, NoPoints,ndf, prob
  //{  16,     0,-0.225000,0.083137,0.020632,-12.286896,0.003591},//115.873177,111,105,0.221724,0,-16,-2.000000,1.000000,-0.800000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  17,     4,-0.175000,0.093281,0.023558,-12.436150,0.001205},//328.747059,119,113,0.000000,0,-17,-0.200000,1.000000,-0.600000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  18,     7,-0.125000,0.104663,0.022847,-12.589160,0.000649},//185.529756,117,111,0.000005,0,-18,-0.200000,1.000000,-0.500000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  19,    10,-0.075000,0.117433,0.026431,-12.729482,0.000482},//172.398103,119,113,0.000179,0,-19,-0.200000,1.000000,-0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  20,    12,-0.025000,0.131763,0.032614,-12.857366,0.000628},//254.880688,129,123,0.000000,0,-20,-0.200000,1.000000,-0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  21,    15,0.025000,0.147840,0.000764,-12.986417,0.000369},//256.985815,134,128,0.000000,0,-21,-0.200000,1.000000,-0.100000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  22,    18,0.075000,0.165879,-0.010958,-13.073500,0.000400},//226.410362,141,135,0.000001,0,-22,-0.200000,1.000000,-0.060000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  23,    28,0.125000,0.186120,-0.019778,-13.160031,0.000234},//1002.408367,150,147,0.000000,0,-23,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  24,    33,0.175000,0.208830,-0.029097,-13.249679,0.000391},//887.578376,166,160,0.000000,0,-24,-0.200000,0.200000,0.200000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  25,    39,0.225000,0.234311,-0.018603,-13.308672,0.000220},//804.040993,180,174,0.000000,0,-25,-0.200000,0.200000,0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  26,    41,0.275000,0.262901,-0.008233,-13.355568,0.000178},//914.356473,192,186,0.000000,0,-26,-0.200000,0.200000,0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  27,    45,0.325000,0.294980,-0.004323,-13.391492,0.000160},//1789.396967,199,193,0.000000,0,-27,-0.200000,0.200000,0.600000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  28,    48,0.375000,0.330973,-0.009842,-13.418429,0.000148},//1301.011674,200,191,0.000000,0,-28,-0.200000,0.200000,0.600000,-1.000000,0.600000,1.000000,-1.000000,1.000000,0.000000,0.000000},
{  29,    50,0.425000,0.371357,-0.011702,-13.437195,0.000140},//1237.174018,200,191,0.000000,0,-29,-0.200000,0.200000,0.600000,-1.000000,0.600000,1.000000,-1.000000,1.000000,0.000000,0.000000},
{  30,    53,0.475000,0.416670,-0.011161,-13.448988,0.000135},//1173.754232,200,191,0.000000,0,-30,-0.200000,0.200000,0.400000,-1.000000,0.600000,0.700000,-1.000000,1.000000,0.000000,0.000000},
{  31,    56,0.525000,0.467511,-0.011047,-13.455028,0.000132},//1155.005767,200,194,0.000000,0,-31,-0.200000,0.200000,0.500000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  32,    58,0.575000,0.524556,-0.012013,-13.455994,0.000131},//1723.536175,200,194,0.000000,0,-32,-0.200000,0.200000,0.500000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  33,    61,0.625000,0.588562,-0.012419,-13.453908,0.000138},//1175.352712,200,191,0.000000,0,-33,-0.200000,0.200000,0.500000,-1.000000,1.000000,1.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  34,    64,0.675000,0.660377,-0.014578,-13.451098,0.000215},//1298.816397,200,191,0.000000,0,-34,-0.200000,0.200000,0.500000,-1.000000,1.000000,0.900000,-1.000000,1.000000,0.000000,0.000000},
{  35,    68,0.725000,0.740955,-0.011034,-13.440177,0.000285},//2134.161587,200,191,0.000000,0,-35,-0.200000,0.100000,0.800000,-1.000000,1.000000,0.400000,-1.000000,1.000000,0.000000,0.000000},
{  36,    74,0.775000,0.831365,-0.010618,-13.429980,0.000845},//1019.619118,200,191,0.000000,0,-36,-0.200000,0.100000,0.600000,-1.000000,1.000000,0.400000,-1.000000,1.000000,0.000000,0.000000},
  //{  37,    77,0.825000,0.932807,0.000418,-13.408068,0.000148},//1314.544249,200,194,0.000000,0,-37,-0.200000,0.100000,0.600000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  38,    79,0.875000,1.046627,-0.006131,-13.402654,0.000162},//1143.681822,200,194,0.000000,0,-38,-0.200000,0.100000,0.600000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  39,    81,0.925000,1.174335,-0.013878,-13.397440,0.000260},//1135.629382,200,194,0.000000,0,-39,-0.200000,0.100000,0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  40,    84,0.975000,1.317625,-0.023646,-13.393237,0.000431},//721.942900,196,190,0.000000,0,-40,-0.200000,0.100000,0.100000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  41,    86,1.025000,1.478400,-0.005323,-13.361114,0.000432},//738.548984,196,190,0.000000,0,-41,-0.200000,0.100000,0.100000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  42,    90,1.075000,1.658792,-0.017917,-13.360130,0.000240},//843.706012,186,177,0.000000,0,-42,-0.200000,0.100000,0.060000,-1.000000,1.000000,0.100000,-1.000000,1.000000,0.000000,0.000000},
  //{  43,    92,1.125000,1.861195,-0.027058,-13.355843,0.000478},//863.949395,175,166,0.000000,0,-43,-0.200000,0.100000,0.060000,-1.000000,1.000000,0.100000,-1.000000,1.000000,0.000000,0.000000},
  //{  44,    95,1.175000,2.088295,0.008643,-13.306922,0.002857},//173.077692,156,147,0.068374,0,-44,-0.200000,0.100000,-0.060000,-1.000000,1.000000,0.300000,-1.000000,1.000000,0.000000,0.000000},
  //{  45,    98,1.225000,2.343106,0.034140,-13.268364,0.003141},//242.117151,143,134,0.000000,0,-45,-0.200000,0.100000,-0.600000,-1.000000,1.000000,0.300000,-1.000000,1.000000,0.000000,0.000000},
  //{  46,   100,1.275000,2.629008,0.036852,-13.252770,0.002903},//242.662188,130,121,0.000000,0,-46,-0.200000,0.100000,-0.600000,-1.000000,1.000000,0.300000,-1.000000,1.000000,0.000000,0.000000},
{  47,   108,1.325000,2.949796,0.006615,-13.269266,0.010907},//99.284267,114,105,0.638922,0,-47,0.000000,1.000000,-0.150000,-1.000000,1.000000,0.010000,-1.000000,1.000000,0.000000,0.000000},
{  48,   111,1.375000,3.309725,0.007209,-13.254120,0.005340},//77.070236,96,87,0.768044,0,-48,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.050000,-1.000000,1.000000,0.000000,0.000000},
{  49,   115,1.425000,3.713573,0.009282,-13.237513,0.005731},//84.094365,97,88,0.598089,0,-49,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.050000,-1.000000,1.000000,0.000000,0.000000},
{  50,   119,1.475000,4.166697,-0.003626,-13.236375,0.009475},//81.240050,81,72,0.215200,0,-50,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.100000,-1.000000,1.000000,0.000000,0.000000},
{  51,   121,1.525000,4.675111,-0.001036,-13.220703,0.015337},//57.856278,71,62,0.625703,0,-51,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.100000,-1.000000,1.000000,0.000000,0.000000},
{  52,   123,1.575000,5.245561,0.004981,-13.202620,0.012956},//51.588762,67,58,0.710962,0,-52,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.100000,-1.000000,1.000000,0.000000,0.000000},
{  53,   125,1.625000,5.885616,0.014458,-13.180267,0.024447},//43.209820,60,51,0.772645,0,-53,0.000000,1.000000,-0.150000,-1.000000,1.000000,-0.100000,-1.000000,1.000000,0.000000,0.000000},
{   7,     4,-0.675000,0.029498,0.073120,-10.537666,0.005955},//72.121064,69,66,0.286186,1,-7,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{   8,     8,-0.625000,0.033097,0.042421,-10.739130,0.004160},//55.484491,73,70,0.897275,1,-8,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{   9,    10,-0.575000,0.037136,0.032002,-10.927971,0.003206},//73.194458,82,79,0.662863,1,-9,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  10,    12,-0.525000,0.041667,0.009802,-11.135055,0.002428},//86.498759,83,80,0.293451,1,-10,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  11,    14,-0.475000,0.046751,0.001277,-11.332453,0.002008},//100.919312,89,86,0.129176,1,-11,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  12,    16,-0.425000,0.052456,-0.006776,-11.531628,0.001718},//116.601904,96,93,0.047505,1,-12,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  13,    18,-0.375000,0.058856,-0.007136,-11.723075,0.001407},//191.001686,105,102,0.000000,1,-13,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  14,    21,-0.325000,0.066038,-0.008446,-11.913832,0.001164},//207.029531,96,93,0.000000,1,-14,-0.500000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  15,    29,-0.275000,0.074096,-0.005268,-12.095675,0.000966},//293.929753,113,110,0.000000,1,-15,-0.500000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  16,    32,-0.225000,0.083137,-0.000721,-12.269751,0.000811},//516.605916,115,112,0.000000,1,-16,-0.400000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  16,    33,-0.225000,0.083137,-0.000721,-12.269751,0.000811},//516.605916,115,112,0.000000,1,-16,-0.400000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  17,    38,-0.175000,0.093281,0.002243,-12.437375,0.000713},//424.889339,104,101,0.000000,1,-17,-0.300000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  18,    43,-0.125000,0.104663,0.008948,-12.590954,0.000639},//363.086978,102,99,0.000000,1,-18,-0.200000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  19,    48,-0.075000,0.117433,0.029901,-12.718852,0.001125},//14284.407161,185,176,0.000000,1,-19,-0.200000,1.000000,-0.700000,-1.000000,1.000000,-0.200000,-1.000000,1.000000,0.000000,0.000000},
  //{  20,    50,-0.025000,0.131763,0.006241,-12.878473,0.000547},//1096.623749,192,183,0.000000,1,-20,-0.200000,1.000000,-0.700000,-1.000000,1.000000,-0.200000,-1.000000,1.000000,0.000000,0.000000},
  //{  21,    52,0.025000,0.147840,0.000467,-12.983967,0.000531},//809.334453,194,185,0.000000,1,-21,-0.200000,1.000000,-0.700000,-1.000000,1.000000,-0.200000,-1.000000,1.000000,0.000000,0.000000},
  //{  22,    54,0.075000,0.165879,-0.023113,-13.082782,0.000879},//682.866247,194,185,0.000000,1,-22,-0.200000,1.000000,-0.700000,-1.000000,1.000000,-0.200000,-1.000000,1.000000,0.000000,0.000000},
  //{  26,    59,0.275000,0.262901,0.009742,-13.335285,0.001946},//300.272918,183,174,0.000000,1,-26,-0.200000,1.000000,-0.700000,-1.000000,1.000000,-0.200000,-1.000000,1.000000,0.000000,0.000000},
  //{  32,    71,0.575000,0.524556,0.010074,-13.433908,0.003177},//72.173536,96,87,0.873632,1,-32,-1.000000,0.100000,0.200000,-1.000000,1.000000,0.100000,-1.000000,1.000000,0.000000,0.000000},
  //{  33,    74,0.625000,0.588562,0.020637,-13.421093,0.004320},//63.707451,81,72,0.746454,1,-33,-1.000000,0.100000,0.200000,-1.000000,1.000000,0.500000,-1.000000,1.000000,0.000000,0.000000},
  //{  34,    77,0.675000,0.660377,0.017228,-13.419531,0.005096},//71.953401,82,73,0.512668,1,-34,-1.000000,0.100000,0.200000,-1.000000,1.000000,0.600000,-1.000000,1.000000,0.000000,0.000000},
//{  65,    81,2.225000,23.431059,0.011700,-13.062736,0.003223},//92.778489,62,59,0.002514,2,-65,-1.000000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  66,    85,2.275000,26.290081,-0.003191,-13.071440,0.003497},//123.956959,126,117,0.315278,2,-66,-1.000000,0.200000,0.600000,-1.000000,1.000000,0.300000,-1.000000,1.000000,0.000000,0.000000},
  //{  67,    90,2.325000,29.497956,0.009028,-13.052684,0.001057},//202.144508,129,123,0.000004,2,-67,-1.000000,0.200000,0.600000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  68,    93,2.375000,33.097251,-0.000601,-13.055651,0.005615},//134.375238,130,121,0.192304,2,-68,-1.000000,0.200000,0.600000,-1.000000,1.000000,0.100000,-1.000000,1.000000,0.000000,0.000000},
{  74,   103,2.675000,66.037698,-0.006269,-13.033139,0.001171},//1247.536922,179,173,0.000000,2,-74,-0.050000,1.000000,-0.300000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  75,   106,2.725000,74.095515,-0.007539,-13.031127,0.000890},//445.801721,141,135,0.000000,2,-75,-0.050000,1.000000,-0.300000,-1.000000,0.400000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{  77,     3,2.825000,93.280727,-0.003494,-13.020546,0.000702},//618.896430,197,188,0.000000,2,-77,-0.050000,1.000000,-0.300000,-1.000000,0.400000,0.500000,-1.000000,1.000000,0.000000,0.000000},
  //{  78,     9,2.875000,104.662697,-0.001316,-13.015119,0.000689},//693.971805,195,186,0.000000,2,-78,-0.200000,0.200000,-0.300000,-1.000000,0.400000,0.500000,-1.000000,1.000000,0.000000,0.000000},
  //{  81,    14,3.025000,147.839989,-0.002549,-13.010697,0.000446},//1043.658338,200,191,0.000000,2,-81,-0.200000,0.200000,-0.300000,-1.000000,0.400000,0.500000,-1.000000,1.000000,0.000000,0.000000},
{  10,     2,-0.525000,0.041667,0.027732,-11.120055,0.016940},//41.407557,43,40,0.416020,3,-10,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  11,     4,-0.475000,0.046751,0.011530,-11.324809,0.005927},//50.299898,49,46,0.311871,3,-11,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  12,     6,-0.425000,0.052456,0.014337,-11.512987,0.004028},//36.953935,57,54,0.963094,3,-12,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  13,     8,-0.375000,0.058856,0.001810,-11.716246,0.002719},//50.426175,62,59,0.779032,3,-13,-0.600000,0.600000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  14,    11,-0.325000,0.066038,-0.000959,-11.908109,0.001939},//53.681025,67,64,0.817663,3,-14,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
//{  15,    13,-0.275000,0.074096,0.005170,-12.087111,0.001448},//95.658275,72,69,0.016709,3,-15,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  16,    15,-0.225000,0.083137,0.004221,-12.266922,0.001108},//127.648433,75,72,0.000029,3,-16,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  17,    19,-0.175000,0.093281,0.007987,-12.433372,0.000902},//69.691272,60,57,0.119819,3,-17,-0.300000,0.300000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{  18,    22,-0.125000,0.104663,0.014174,-12.587444,0.000766},//3280.789940,193,184,0.000000,3,-18,-0.300000,0.300000,-0.500000,-0.600000,0.500000,-0.900000,-1.000000,1.000000,0.000000,0.000000},
  //{  21,    27,0.025000,0.147840,0.000937,-12.984383,0.000533},//14345.890060,200,191,0.000000,3,-21,-0.300000,0.300000,-0.300000,-0.600000,0.500000,-0.750000,-1.000000,1.000000,0.000000,0.000000},
  //{  22,    31,0.075000,0.165879,-0.006399,-13.067018,0.000540},//18102.503504,200,191,0.000000,3,-22,-0.300000,0.300000,-0.300000,-0.600000,0.500000,-0.750000,-1.000000,1.000000,0.000000,0.000000},
};
#if 0
Point_t dEdxZ[]  = {
  //bin, Point, x,          p,       z,       y,      dy,     chisq, NoPoints,ndf, prob
  { 7,     3,-0.350000,0.062344,0.023587,1.994942,0.001633},//129.162293,146,137,0.670883},
  //hyp,bin1,xmin1,xmax1,    Mu2,    xmin2,   xmax2,      Mu3,    xmin3,   xmax3,     Mu4,  dum
  //0,7,-0.200000,1.000000,-0.500000,-0.700000,1.000000,-1.000000,-1.000000,1.000000,0.000000,0.000000},
  { 8,     6,-0.250000,0.078486,0.008785,1.617042,0.001597},//156.451031,153,141,0.177227},
  //0,8,-0.200000,1.000000,-0.500000,-0.700000,1.000000,-1.000000,-1.000000,1.000000,0.300000,0.000000},
  //  { 9,     7,-0.150000,0.098808,0.016448,1.292353,0.000673},//241.799462,179,167,0.000091},
//0,9,-0.200000,1.000000,-0.500000,-0.700000,1.000000,-1.000000,-1.000000,1.000000,0.300000,0.000000},
  //  {10,    11,-0.050000,0.124392,-0.033534,0.951494,0.001807},//513.185181,195,183,0.000000},
//0,10,-0.200000,1.000000,-0.250000,-1.000000,1.000000,0.040000,-1.000000,1.000000,0.200000,0.000000},
  //  {11,    18,0.050000,0.156600,-0.008454,0.778559,0.000173},//758.131461,198,189,0.000000},
//0,11,-0.100000,0.100000,-0.200000,-1.000000,1.000000,0.008000,-1.000000,1.000000,0.000000,0.000000},
  //  {12,     3,0.150000,0.197148,-0.027043,0.604984,0.000311},//2159.187571,200,188,0.000000},
//0,12,-0.100000,0.100000,-0.200000,-1.000000,0.100000,-0.700000,-1.000000,1.000000,0.300000,0.000000},
  //  {13,     9,0.250000,0.248194,-0.019173,0.475949,0.000131},//5671.718831,200,194,0.000000},
//0,13,-0.100000,0.100000,0.084000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //  {14,    14,0.350000,0.312458,-0.006294,0.410863,0.000125},//1802.357663,160,151,0.000000},
//0,14,-0.100000,0.100000,0.070000,-1.000000,0.600000,0.360000,-1.000000,0.600000,0.000000,0.000000},
  //  {15,    17,0.450000,0.393362,-0.009971,0.373704,0.000103},//2628.550797,200,188,0.000000},
//0,15,-0.100000,0.100000,0.100000,-0.600000,0.600000,0.360000,-1.000000,1.000000,0.800000,0.000000},
  {16,    18,0.550000,0.495213,-0.010294,0.361235,0.000100},//2906.848267,200,188,0.000000},
//0,16,-0.100000,0.100000,0.100000,-0.600000,0.600000,0.360000,-1.000000,1.000000,0.800000,0.000000},
  {17,    21,0.650000,0.623436,-0.011287,0.365201,0.000029},//12560.508901,200,188,0.000000},
//0,17,-0.100000,0.100000,0.100000,-0.600000,0.600000,0.360000,-1.000000,1.000000,0.800000,0.000000},
  {18,    22,0.750000,0.784860,-0.011480,0.379654,0.000318},//4034.675590,200,188,0.000000},
//0,18,-0.100000,0.100000,0.100000,-0.600000,0.600000,0.360000,-1.000000,1.000000,0.800000,0.000000},
  //  {19,     3,0.850000,0.988080,-0.002519,0.410221,0.000089},//3227.235245,200,188,0.000000},
//0,19,-0.100000,0.100000,-0.670000,-1.000000,1.000000,-0.120000,-1.000000,1.000000,0.370000,0.000000},
  //  {20,     9,0.950000,1.243918,-0.020578,0.417914,0.000156},//474.582698,200,188,0.000000},
//0,20,-0.100000,0.100000,-0.075000,-1.000000,1.000000,-0.020000,-1.000000,1.000000,0.770000,0.000000},
  {21,    11,1.050000,1.566001,-0.015381,0.450528,0.000490},//2335.016420,200,188,0.000000},
//0,21,-0.100000,0.100000,0.042000,-1.000000,1.000000,-0.630000,-1.000000,1.000000,0.770000,0.000000},
  //  {22,    17,1.150000,1.971478,0.001336,0.493926,0.000992},//1389.864056,199,187,0.000000},
  //0,22,-0.200000,0.200000,0.010000,-1.000000,1.000000,-0.034000,-1.000000,1.000000,0.050000,0.000000},
  //  {23,    19,1.250000,2.481944,0.025113,0.543693,0.002435},//837.756781,199,187,0.000000},
  //0,23,-0.100000,0.100000,0.024000,-1.000000,1.000000,-0.034000,-1.000000,1.000000,0.050000,0.000000},
  //  {24,    30,1.350000,3.124582,-0.083514,0.462238,0.000448},//840.810291,191,182,0.000000},
  //0,24,-1.000000,1.000000,0.080000,-1.000000,1.000000,0.040000,-1.000000,1.000000,0.000000,0.000000},
  //  {25,    43,1.450000,3.933616,0.022714,0.597224,0.002327},//293.329069,165,156,0.000000},
  //0,25,-0.050000,0.100000,-0.050000,-1.000000,1.000000,0.200000,-1.000000,1.000000,0.000000,0.000000},
  {26,     3,1.550000,4.952129,-0.008574,0.592216,0.005649},//184.577753,151,142,0.008405},
  //0,26,-0.050000,0.200000,-0.100000,-1.000000,1.000000,0.200000,-1.000000,1.000000,0.000000,0.000000},
  {27,     5,1.650000,6.234361,-0.005388,0.620639,0.008816},//176.651134,126,120,0.000424},
  //0,27,-0.050000,0.200000,-0.100000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  {28,     0,1.750000,7.848595,0.043486,0.694852,0.016543},//123.740353,115,109,0.158510},
  //0,28,-0.050000,0.200000,-0.100000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  { 3,     3,-0.750000,0.024819,0.073900,3.508065,0.004425},//129.487128,131,125,0.377162},
  //1,3,-0.400000,0.400000,-0.900000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  { 4,     8,-0.650000,0.031246,0.042201,3.155453,0.002083},//205.167071,169,163,0.012909},
  //1,4,-0.400000,0.400000,-0.900000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  {   5,     0,-0.550000,0.039336,0.013017,2.771017,0.001320},//109.420790,82,79,0.011808},
  //1,5,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //  {   6,     3,-0.450000,0.049521,-0.004886,2.377465,0.000871},//669.583932,190,184,0.000000},
  //1,6,-0.400000,1.000000,-0.800000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  {   7,    14,-0.350000,0.062344,-0.002242,2.000363,0.000741},//793.749811,196,187,0.000000},
  //1,7,-0.300000,0.300000,-0.900000,-1.000000,1.000000,-0.400000,-1.000000,1.000000,0.000000,0.000000},
  //  {   8,    16,-0.250000,0.078486,0.005082,1.640389,0.000573},//917.278307,200,188,0.000000},
  //1,8,-0.300000,0.300000,-0.840000,-1.000000,1.000000,-1.300000,-1.000000,1.000000,-0.200000,0.000000},
  //  {   9,    18,-0.150000,0.098808,0.007784,1.304448,0.000410},//2745.873482,191,182,0.000000},
  //1,9,-0.300000,0.300000,-0.840000,-1.000000,1.000000,-1.300000,-0.900000,1.000000,0.000000,0.000000},
  //  {  10,     0,-0.050000,0.124392,-0.003774,0.997044,0.000411},//3390.594259,200,191,0.000000},
  //1,10,-0.300000,0.300000,-0.600000,-0.800000,0.300000,0.400000,-1.000000,1.000000,0.000000,0.000000},
  {  11,     1,0.050000,0.156600,-0.016865,0.778414,0.000472},//5833.113117,200,191,0.000000},
  //1,11,-0.300000,0.300000,-0.600000,-0.800000,0.300000,0.400000,-1.000000,1.000000,0.000000,0.000000},
  //  {  13,     2,0.250000,0.248194,-0.044133,0.457535,0.000118},//3320.310660,200,191,0.000000},
  //1,13,-0.300000,0.300000,-0.600000,-0.800000,0.300000,0.400000,-1.000000,1.000000,0.000000,0.000000},
  //  {  14,     3,0.350000,0.312458,0.035610,0.455423,0.000162},//1383.640530,200,191,0.000000},
  //1,14,-0.300000,0.300000,-0.600000,-0.800000,0.300000,0.400000,-1.000000,1.000000,0.000000,0.000000},
  {  31,    11,2.050000,15.660006,-0.013982,0.701351,0.001619},//128.663962,101,98,0.018891},
  //2,31,-5.000000,0.500000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  {  32,    15,2.150000,19.714779,-0.012665,0.717696,0.000588},//414.626680,198,189,0.000000},
  //2,32,-5.000000,0.300000,1.000000,-1.000000,1.000000,0.500000,-1.000000,1.000000,0.000000,0.000000},
  //  {  33,    17,2.250000,24.819437,-0.002418,0.741590,0.000411},//1289.334345,199,190,0.000000},
  //2,33,-5.000000,0.300000,0.650000,-1.000000,1.000000,0.600000,-1.000000,1.000000,0.000000,0.000000},
  //  {  34,    19,2.350000,31.245820,-0.015821,0.741672,0.000310},//1030.843637,200,191,0.000000},
  //2,34,-5.000000,0.300000,0.340000,-1.000000,1.000000,0.680000,-1.000000,1.000000,0.000000,0.000000},
  //  {  35,    21,2.450000,39.336156,0.070502,0.839531,0.000147},//4602.446568,200,197,0.000000},
  //2,35,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  {   5,    25,-0.550000,0.039336,0.033212,2.783089,0.003826},//60.224079,71,68,0.737700,
  //3,5,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{   6,    26,-0.450000,0.049521,0.009835,2.385357,0.001720},//69.200661,78,75,0.666938},
  //3,6,-0.400000,0.400000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{   7,    29,-0.350000,0.062344,0.002137,1.998587,0.000942},//74.702101,60,57,0.055585},
  //3,7,-0.300000,0.300000,0.000000,-1.000000,1.000000,0.000000,-1.000000,1.000000,0.000000,0.000000},
{   8,    30,-0.250000,0.078486,0.003702,1.633004,0.000594},//344.335837,60,57,0.000000},
  //3,8,-0.300000,0.300000,-1.000000,-1.000000,0.400000,0.000000,-1.000000,1.000000,0.000000,0.000000},
  //{   9,    38,-0.150000,0.098808,0.012801,1.303782,0.000431},//998.400978,141,132,0.000000},
  //3,9,-0.300000,0.300000,-0.920000,-1.000000,0.400000,-0.500000,-1.000000,0.400000,0.000000,0.000000},
  //{  10,    41,-0.050000,0.124392,0.028264,1.024139,0.000948},//558.232523,141,132,0.000000},
  //3,10,-0.300000,0.300000,-0.920000,-1.000000,0.400000,-0.500000,-1.000000,0.400000,0.000000,0.000000},
  //{  11,    42,0.050000,0.156600,-0.016314,0.776150,0.000382}//4580.360615,141,132,0.000000}
  //3,11,-0.300000,0.300000,-0.920000,-1.000000,0.400000,-0.500000,-1.000000,0.400000,0.000000,0.000000}
  };
struct Point_t {
  Double_t x;
  Double_t z; // correction wrt Manuel
  Double_t y;
  Double_t dy;
};
Point_t dEdxZ[] = {
  {-0.25,0.066638,1.579032,0.001282},
  {-0.15,0.065417,1.2918,0.000489},
  {-0.05,0.047827,1.014476,0.001343},
  {0.05,0.034777,0.786168,0.000289},
  {0.15,0.026786,0.604832,0.002922},
  {0.25,0.037610,0.492248,0.000227},
  {0.35,0.040954,0.419698,0.000152},
  {0.45,0.038396,0.382992,0.000213},
  {0.55,0.033616,0.366155,0.000788},
  {0.65,0.035769,0.371776,0.000474},
  {0.75,0.041477,0.391697,0.002503},
  {0.85,0.036853,0.416895,0.000161},
  {0.95,0.035566,0.433326,0.000456},
  {1.05,0.035722,0.463824,0.000310},
  {-0.65,0.007207,3.170663,0.004101},
  {-0.55,0.044418,2.778920,0.002115},
  {-0.45,0.058974,2.377828,0.001355},
  {-0.35,0.059281,1.999874,0.001125},
  {-0.25,0.052571,1.635731,0.001182},
  {-0.15,0.050820,1.308309,0.000859},
  {-0.05,0.043449,1.027091,0.000620},
  {2.15,0.092535,0.732080,0.001756},
  {2.25,0.065314,0.747486,0.001138},
  {-0.45,0.070985,2.384659,0.003376},
  {-0.35,0.065843,1.999036,0.001630},
  {-0.25,0.062562,1.638850,0.000932},
  {-0.15,0.056202,1.307322,0.000642},
  {-0.05,-0.006113,0.972603,0.001437},
  {-0.65,-0.173014,3.001570,0.022785},
  {-0.45,0.013935,2.345955,0.030774},
  {-0.35,0.063810,2.013076,0.018433}};
Point_t dEdxZ[] = {
{-0.25,0.066638,1.579032,0.001282},
{-0.15,0.065417,1.2918,0.000489},
{-0.05,0.047827,1.014476,0.001343},
{0.05,0.034777,0.786168,0.000289},
{0.15,0.026786,0.604832,0.002922},
{0.25,0.037610,0.492248,0.000227},
{0.35,0.040954,0.419698,0.000152},
{0.45,0.038396,0.382992,0.000213},
{0.55,0.033616,0.366155,0.000788},
{0.65,0.035769,0.371776,0.000474},
{0.75,0.041477,0.391697,0.002503},
{0.85,0.036853,0.416895,0.000161},
{0.95,0.035566,0.433326,0.000456},
{1.05,0.035722,0.463824,0.000310},
{-0.65,0.007207,3.170663,0.004101},
{-0.55,0.044418,2.778920,0.002115},
{-0.45,0.058974,2.377828,0.001355},
{-0.35,0.059281,1.999874,0.001125},
{-0.25,0.052571,1.635731,0.001182},
{-0.15,0.050820,1.308309,0.000859},
{-0.05,0.043449,1.027091,0.000620},
{2.15,0.092535,0.732080,0.001756},
{2.25,0.065314,0.747486,0.001138},
{2.35,0.028909,0.753751,0.000859},
{-0.45,0.070985,2.384659,0.003376},
{-0.35,0.065843,1.999036,0.001630},
{-0.25,0.062562,1.638850,0.000932},
{-0.15,0.056202,1.307322,0.000642},
{-0.05,-0.006113,0.972603,0.001437},
{-0.65,-0.173014,3.001570,0.022785},
{-0.45,0.013935,2.345955,0.030774},
{-0.35,0.063810,2.013076,0.018433},
};
Point_t dEdxZ[] = {
  { -0.25,0.480332,0.001282},
  { -0.15,0.269486,0.000489},
  { -0.05,0.013907,0.001343},
  { 0.05,-0.251052,0.000289},
  { 0.15,-0.521317,0.002922},
  { 0.25,-0.750644,0.000227},
  { 0.35,-0.929942,0.000152},
  { 0.45,-1.026986,0.000213},
  { 0.55,-1.067383,0.000788},
  { 0.65,-1.054856,0.000474},
  { 0.75,-1.007717,0.002503},
  { 0.85,-0.930620,0.000161},
  { 0.95,-0.886340,0.000456},
  { 1.05,-0.812672,0.000310},
  { -0.65,1.158872,0.004101},
  { -0.55,1.050367,0.002115},
  { -0.45,0.900047,0.001355},
  { -0.35,0.722274,0.001125},
  { -0.25,0.511994,0.001182},
  { -0.15,0.279937,0.000859},
  { -0.05,0.026956,0.000620},
  { 2.15,-0.354463,0.001756},
  { 2.25,-0.317160,0.001138},
  { 2.35,-0.292893,0.000859},
  { -0.45,0.909822,0.003376},
  { -0.35,0.725016,0.001630},
  { -0.25,0.517635,0.000932},
  { -0.15,0.280241,0.000642},
  { -0.05,-0.027627,0.001437},
  { -0.65,0.982163,0.022785},
  { -0.45,0.860670,0.030774},
  { -0.35,0.731263,0.018433},
  { 0.35,-0.943118,0.007931},
  { 0.45,-0.994008,0.014000}
};
#endif
const Int_t N = sizeof(dEdxZ)/sizeof(Point_t);
//________________________________________________________________________________
Double_t Girrf(Double_t poverm) {
  //        returns value of relative ionisation normalised to value
  //        at p/m=4 poverm    p/m (=beta gamma)             (input)
  Double_t dsri[] = { // table for log(Ekin) for muon , xlow = -4.94713; dx = 0.1
    0.75591,   0.73857,   0.69776,   0.63873,   0.57037,
    0.50158,   0.43821,   0.38250,   0.33417,   0.29199,
    0.25472,   0.22149,   0.19175,   0.16518,   0.14223,
    0.12192,   0.10391,   0.08812,   0.07443,   0.06264,
    0.05200,   0.04372,   0.03669,   0.03073,   0.02571,
    0.02149,   0.01796,   0.01502,   0.01258,   0.01056,
    0.00889,   0.00752,   0.00640,   0.00548,   0.00474,
    0.00414,   0.00367,   0.00329,   0.00300,   0.00277,
    0.00261,   0.00250,   0.00242,   0.00238,   0.00237,
    0.00239,   0.00242,   0.00247,   0.00253,   0.00260,
    0.00267,   0.00275,   0.00284,   0.00293,   0.00301,
    0.00310,   0.00319,   0.00328,   0.00337,   0.00346,
    0.00355,   0.00363,   0.00370,   0.00377,   0.00383,
    0.00389,   0.00395,   0.00400,   0.00405,   0.00409,
    0.00413,   0.00417,   0.00420,   0.00424,   0.00427,
    0.00430,   0.00432,   0.00435,   0.00438,   0.00440,
    0.00443,   0.00445,   0.00448,   0.00450,   0.00453,
    0.00455,   0.00458,   0.00460,   0.00463};
  Double_t MuonMass = 0.1057;
  Double_t sirrf = 0;
  Double_t Ekin = MuonMass*(TMath::Sqrt(1. + poverm*poverm) - 1);
  Double_t pt = 10.*(TMath::Log10(Ekin) + 4.94713);
  if (pt < 0) pt = 0;
  //  printf("poverm = %f Ekin = %f pt = %f\n",poverm,Ekin,pt);
  if (pt > 88.) pt = 98.; // if p/m above 10000 treat as saturated
  Int_t ipt = pt;
  if (ipt < 0) return sirrf;
  Double_t dpt = pt - ipt;
  sirrf = dsri[ipt] + (dsri[ipt+1] - dsri[ipt])*dpt;
  //  printf("Girrf: pt = %f ipt = %i dpt = %f:%f %f \n",pt,ipt,dpt,dsri[ipt],dsri[ipt+1]);
  //  printf("Girrf: poverm = %f sirrf = %f\n",poverm,sirrf);
  return sirrf;
}
//________________________________________________________________________________
Double_t Sirrf(Double_t poverm) {
  //        returns value of relative ionisation normalised to value
  //        at p/m=4 poverm    p/m (=beta gamma)             (input)
  Double_t dsri[40] = { 
    1.640, 1.410, 1.2, 1.070, 1.025,
    1.0, 1.0, 1.010, 1.030, 1.055,
    1.085, 1.115, 1.145, 1.175, 1.210,
    1.245, 1.275, 1.310, 1.340, 1.370,
    1.395, 1.420, 1.440, 1.460, 1.480,
    1.495, 1.510, 1.520, 1.530, 1.540,
    1.545, 1.550, 1.555, 1.560, 1.560,
    1.560, 1.560, 1.560, 1.560, 1.560};
//  FCN=205.719 FROM END         STATUS=CONVERGED       1 CALLS          99 TOTAL
//                      EDM=5.62453e-12    STRATEGY= 1      ERROR MATRIX ACCURATE 
//   EXT PARAMETER                                   STEP         FIRST   
//   NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE 
//    1  a1           3.60086e-01   6.48928e-05   4.39215e-07  -3.76285e-02
//    2  a2           6.53488e-02   1.26266e-03   1.23090e-06   5.35992e-03
//    3  a3          -2.27416e-02   7.89638e-04   7.67950e-07   1.37287e-02
//    4  a4           3.40098e-03   5.71512e-03   3.13919e-06  -2.73059e-03
//
//  FCN=179.472 FROM END         STATUS=CONVERGED       1 CALLS          41 TOTAL
//                      EDM=2.51693e-11    STRATEGY= 1      ERROR MATRIX ACCURATE 
//   EXT PARAMETER                                   STEP         FIRST   
//   NO.   NAME      VALUE            ERROR          SIZE      DERIVATIVE 
//    1  a1          -5.44295e-04   1.23335e-04   4.10385e-07  -9.61953e-02
//    2  a2           4.89398e-04   9.55258e-05   3.17854e-07  -1.46369e-01
//
  //  Double_t par[4] = {1.43345268619059651, 6.53488e-02, -2.27416e-02, 3.40098e-03};
  Double_t par[5] = {1.43267267735747716, 6.53488e-02, -2.27416e-02, 3.40098e-03, 4.89398e-04 };
  Double_t sirrf;
  Double_t pt = 10.*TMath::Log10 (poverm);
  if (pt <  0.) pt =  0.;
  if (pt > 38.) pt = 38.; // if p/m above 10000 treat as saturated
  Int_t ipt = pt;
  Double_t dpt = pt - ipt;
  Double_t Lpoverm = TMath::Log(poverm);
  sirrf = par[0]*(dsri[ipt] + (dsri[ipt+1] - dsri[ipt])*dpt);
  sirrf *= TMath::Exp(par[4]*Lpoverm);
  if (poverm < 1.) {
    Double_t beta2inv = 1. + 1./(poverm*poverm);
    Double_t Lbeta2inv = TMath::Log(beta2inv);
    sirrf *= beta2inv/2;
    sirrf *= TMath::Exp(Lbeta2inv*(par[1]+Lbeta2inv*(par[2])) + Lpoverm*par[3]);
  } 
  return sirrf;
}
//________________________________________________________________________________
Double_t Birrf(Double_t poverm) {
  // H.Bixel calculations for x == 2cm       
  // returns value of relative ionisation normalised to value
  //        at p/m=4 poverm    p/m (=beta gamma)             (input)
  Double_t dsri[50] = { 
  78394.200521,53122.648438,38794.142578,24980.895508,16196.155273,
  10606.439941,7065.127686,4841.811523,3450.702271,2577.135986,
  1899.399536,1627.032959,1489.027710,1373.974792,
  1315.645203,1294.576477,1297.790039,1316.794495,
  1346.162292,1382.154968,1432.996826,1476.141479,
  1509.566223,1554.324463,1598.915710,1643.166016,
  1685.602783,1725.277222,1762.218506,1796.898987,
  1837.022502,1867.471558,1889.173462,1916.665771,
  1942.244263,1965.767517,1986.660522,2004.403748,
  2019.357971,2030.344482,2040.678182,2047.282471,
  2049.885498,2053.357544,2054.881714,2056.579468,
  2057.499512,2057.499512,2059.227539,2059.227539};
  Double_t pt = 10.*(1+TMath::Log10 (poverm));
  if (pt > 48.) pt = 48.; // if p/m above 10000 treat as saturated
  Int_t ipt = pt;
  Double_t dpt = pt - ipt;
  Double_t sirrf = dsri[ipt] + (dsri[ipt+1] - dsri[ipt])*dpt;
  //    printf("Sirrf: pt = %f ipt = %i dpt = %f:%f %f \n",pt,ipt,dpt,dsri[ipt],dsri[ipt+1]);
  //  printf("Sirrf: poverm = %f sirrf = %f\n",poverm,sirrf);
  return sirrf;
}
//______________________________________________________________________________
Double_t func(Double_t *x,Double_t *par)
{

  Double_t poverm = pow(10.,x[0]);
  Double_t beta2inv = 1. + 1./(poverm*poverm);
  //  Double_t value = TMath::Log(1. + par[0] + par[1]*beta2inv + par[2]*beta2inv*TMath::Log(poverm));
  Double_t value;
  Double_t Lbeta2inv = TMath::Log(beta2inv);
  Double_t Lpoverm = TMath::Log(poverm);
  //  value=par[0]+TMath::Log(1.e-6*Sirrf(poverm)) + Lbeta2inv*(par[1]+par[2]*Lbeta2inv);
  value=par[0]+TMath::Log(1.e-6*Sirrf(poverm)) + Lpoverm*par[1];
  //  if (poverm > 1.) value +=  TMath::Log(Lpoverm)*par[1];
//   if (poverm < 1) {
//     value+= Lbeta2inv*(par[1]+Lbeta2inv*(par[2])) + Lpoverm*par[3];
//   }
  //  value += par[1]*TMath::Log(beta2inv) + par[2]*TMath::Log(poverm);
  //  value += TMath::Log(1. + par[1]*beta2inv + par[2]*beta2inv*TMath::Log(poverm));
//   Double_t value=par[0]+TMath::Log(Girrf(pow(10.,x[0])));
//   Double_t value=par[0]+TMath::Log(Birrf(pow(10.,x[0])));

//   if (poverm<1.) {
//     Double_t beta2inv = 1. + 1./(poverm*poverm);
//     value *= (1. + (par[1] + par[2]*beta2inv)*beta2inv);
//   }
  
  return value;
}

//______________________________________________________________________________
void fcn(Int_t &npar, Double_t *gin, Double_t &f, Double_t *par, Int_t iflag){
  Int_t i;
  
  //calculate chisquare
  Double_t chisq = 0;
  Double_t delta;
  Int_t bad = 0; 
  Double_t worse = 0.;
  for (i=0;i<N; i++) {
    Double_t xx = dEdxZ[i].x;
    Double_t val =  func(&xx,par);   
    delta  = TMath::Abs((dEdxZ[i].y-val)/dEdxZ[i].dy);
    if (iflag == 3) {
      printf ("%i bin %i point %i x = %f y = %f +/- %f function  %f delta = %f\n",i,
	      dEdxZ[i].bin, dEdxZ[i].NPoint, dEdxZ[i].x,dEdxZ[i].y,dEdxZ[i].dy,val,delta);
      if (worse < delta) {
	worse = delta; bad = i;
      }
    }
    chisq += delta*delta;
  }
  if (iflag == 3) {
    printf("The worst bin = %i\n",bad);
    i = bad; delta = worse;
    printf ("%i bin %i point %i x = %f y = %f +/- %f function  %f delta = %f\n",i,
	    dEdxZ[i].bin, dEdxZ[i].NPoint, dEdxZ[i].x,dEdxZ[i].y,dEdxZ[i].dy,val,delta);
  }
  f = chisq;
}

//______________________________________________________________________________
void Bfit()
{
  TMinuit *gMinuit = new TMinuit(5);  //initialize TMinuit with a maximum of 5 params
  gMinuit->SetFCN(fcn);

  Double_t arglist[10];
  Int_t ierflg = 0;
  //   f1->SetParNames("constant","coefficient");
  arglist[0] = 1;
  gMinuit->mnexcm("SET ERR", arglist ,1,ierflg);
  
  // Set starting values and step sizes for parameters
  //  static Double_t vstart[4] = {3.59928e-01,6.48520e-02,-2.32289e-02, -3.58118e-04};
  static Double_t vstart[4] = {0,0,0,0};
  static Double_t step[4] = {0.1 , 0.1 , 0.01 , 0.001};
  gMinuit->mnparm(0, "a1", vstart[0], step[0], 0,0,ierflg);
  gMinuit->mnparm(1, "a2", vstart[1], step[1], 0,0,ierflg);
  gMinuit->mnparm(2, "a3", vstart[2], step[2], 0,0,ierflg);
  gMinuit->mnparm(3, "a4", vstart[3], step[3], 0,0,ierflg);
  //    gMinuit->mnparm(3, "a4", vstart[3], step[3], 0,0,ierflg);
  
  // Now ready for minimization step
  arglist[0] = 2.;
  //  gMinuit->mnexcm("fix", arglist ,1,ierflg);
  arglist[0] = 500;
  arglist[1] = 1.;
  gMinuit->mnexcm("MIGRAD", arglist ,2,ierflg);
  gMinuit->mnexcm("end", arglist ,0,ierflg);
  // Print results
  Double_t amin,edm,errdef;
  Int_t nvpar,nparx,icstat;
  gMinuit->mnstat(amin,edm,errdef,nvpar,nparx,icstat);
  gMinuit->mnprin(3,amin);
  TF1 *f1 = new TF1("myfunc",func,-1.,4.,1);
  Double_t Z[3],dZ[3];
  TCanvas *c1 = new TCanvas("c1","gerrors2",2,10,700,500);
  //   c1->SetLogy(1);
  c1->SetFillColor(42);
  c1->SetGrid();
  //   TH1F *hr = c1->DrawFrame(-1.,0.0,4.,4.);
  gMinuit->GetParameter(0, Z[0], dZ[0]);
  gMinuit->GetParameter(1, Z[1], dZ[1]);
  gMinuit->GetParameter(2, Z[2], dZ[2]);
  f1->SetParameter(0,Z[0]);
  f1->SetParameter(1,Z[1]);
  f1->SetParameter(2,Z[2]);
  //   f1->Draw("same");
  
  TGraphErrors *gr1 = new TGraphErrors();
  for (int i=0;i<N;i++) {
    Double_t d = dEdxZ[i].y - func(&dEdxZ[i].x,Z);
     //     gr1->SetPoint(i,dEdxZ[i].x,dEdxZ[i].y);
    gr1->SetPoint(i,dEdxZ[i].x,d);
    gr1->SetPointError(i,0,dEdxZ[i].dy);
   }
  //   gr1->SetMarkerColor(hyp+1);
  gr1->SetMarkerStyle(21);
  //   gr1->Draw("ALP");
  gr1->Draw("PA");
}

